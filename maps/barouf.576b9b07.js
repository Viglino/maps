let e,t;let a="";function r(e){let t=e[Math.trunc(Math.random()*e.length)],a="",r=[`Le gars il s'appelle Tin,<br/> c'est le bar \xe0 Tin`,`Le gars il s'appelle Mine,<br/> c'est le bar \xe0 Mine`,`Le gars il s'appelle Ka,<br/> c'est le bar \xe0 Ka`,`Le gars il s'appelle Cuda,<br/> c'est le bar \xe0 Cuda, \u{266B} ha!`,"Le gars il s'appelle Joe,<br/> c'est le bar'Joe","Le gars il s'appelle Jo,<br/> c'est le Jo'bar","Le gars il s'appelle Bichette,<br/> c'est le bar'Bichette","Le gars il s'appelle Bo,<br/> c'est le Bo'bar"];if(t){let e=["https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Alex_Knight_2016_%28Unsplash%29.jpg/330px-Alex_Knight_2016_%28Unsplash%29.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Bar-neon-sign-11291208084Hn6.jpg/330px-Bar-neon-sign-11291208084Hn6.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/Udagawacho%2C_Shibuya%2C_Japan_%28Unsplash%29.jpg/330px-Udagawacho%2C_Shibuya%2C_Japan_%28Unsplash%29.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Is_Open.jpg/330px-Is_Open.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Neon_Open_Sign.jpg/330px-Neon_Open_Sign.jpg"];a=`<h2>${t.properties.Nom}</h2><img src="${e[Math.trunc(Math.random()*e.length)]}" /><p>${t.properties.numeroVoieEtablissement||""}${t.properties.indiceRepetitionEtablissement||""} ${t.properties.typeVoieEtablissement||""} ${t.properties.libelleVoieEtablissement||""} <br/>${t.properties.codePostalEtablissement||""} ${t.properties.libelleCommuneEtablissement||""}</p>`}else a=`<h2>Jeux de mots</h2><img class="jamel" src="https://macarte.ign.fr/api/image/img_rbt18795" /><p>${r[Math.trunc(Math.random()*r.length)]}</p>`;document.querySelector("aside DIV").innerHTML=a}function l(t,a){e.getFeatures({layerId:4,attr:t,op:"regexp",val:a},t=>{e.addLayerFeatures({id:10,features:t,clear:!0}),i(t)})}function i(a){let l=Array.isArray(a)?a.length:a||0;t.filtered=l||0,l?(e.setLayer({id:10,visible:!0}),e.setLayer({id:4,visible:!1})):(e.setLayer({id:10,visible:!1}),e.setLayer({id:4,visible:!0}));let i=document.querySelector("footer section span.total"),s=document.querySelector("footer section span.selected");t?(i.textContent=t.features.toLocaleString(),s.textContent=t.filtered.toLocaleString()):(i.textContent=0,s.textContent=0),r(a)}MapIFrameAPI.ready("map",function(s){(e=s).getFeatures({},e=>{t={features:e.length,filtered:0},i(0);let s={},o=["CAFE","SARL","TABAC","BISTROT","BAR","BRASSERIE","RESTAURANT","PUB","SNACK","PIZZERIA","TRAITEUR","BISTRO","BISTROT","EURL","COMPTOIR","COFFEE","HOTEL","L'HOTEL","BUVETTE","RELAIS","AUBERGE","L'AUBERGE","CAVE","MAISON","PIZZA","TAVERNE","CLUB","DEUX","FOYER","TABLE","CASA","COMITE","ASSOCIATION","INDIVISION","RESTAURATION","FETES","PRESSE","LOUNGE","SOCIETE","SASU","AMICALE"];e.forEach(e=>{e.properties.Nom.split(/ |-|,/).forEach(e=>{e.length>3&&-1===o.indexOf(e)&&(s[e]||(s[e]=0),s[e]++)}),/HOTEL DE VILLE/.test(e.properties.Nom)&&(s["HOTEL DE VILLE"]=(s["HOTEL DE VILLE"]||0)+1)}),s.VOUS-=s.RENDEZ;let n={"P(E|')TITE?S?":["P'TIT","P'TITS","P'TITE","P'TITES","PETIT","PETITS","PETITE","PETITES"],ETOILE:["L'ETOILE"],ESCALE:["L'ESCALE"],EMBUSCADE:["L'EMBUSCADE"],"HALLES?":["HALLE","HALLES"],"RENDEZ(-| )VOUS":["RENDEZ"],"BOULES?":["BOULE","BOULES"],ATELIER:["L'ATELIER"],"SAINTE?S?":["SAINT","SAINTS","SAINTE","SAINTES"],"MOULINS?":["MOULIN","MOULINS"],VILLE:[],"JEAN BART":["BART"]};Object.keys(n).forEach(e=>{s[e]=s[e]||0,n[e].forEach(t=>{s[e]+=s[t]||0,delete s[t]})});let p=Object.keys(s).sort((e,t)=>s[t]-s[e]),E="";for(let e=0;e<100;e++)E+=`<a href="#" class="link" data-what="${p[e]}" data-nb="${s[p[e]]}" aria-label="rechercher...">`+p[e].replace(/.\?/g,"").replace(/\((.)[^\)]*\)/g,"$1")+"</a> - ";(a=document.querySelector("aside .links")).innerHTML=E,a.querySelectorAll(".link").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();let t="\\b"+e.target.dataset.what+"\\b";l("Nom",t),document.querySelector('input[type="search"]').value=t})}),r([])})}),document.querySelector('input[type="search"]').addEventListener("change",e=>{let t=e.target.value;t?l("Nom",t):i(0)}),document.querySelector('input[type="search"]').addEventListener("input",e=>{e.target.value||e.inputType||e.target.blur()}),document.querySelector("header select").value="",document.querySelector("header select").addEventListener("change",t=>{let a=t.target.value;"show"===a?(document.querySelector('input[type="search"]').value="",i(0)):"showall"===a?(document.querySelector('input[type="search"]').value=".*",l("Nom",".*")):"center"===a&&(document.querySelector('input[type="search"]').value?e.setCenter({layerId:10,zoom:16,offsetZoom:-.5}):e.setCenter({layerId:4,zoom:16,offsetZoom:-.5})),t.target.value=""});