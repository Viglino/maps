let e,t;let a="";function r(e){let t=e[Math.trunc(Math.random()*e.length)],r="",l=[`Le gars il s'appelle Tin, c'est le bar \xe0 Tin`,`Le gars il s'appelle Mine, c'est le bar \xe0 Mine`,`Le gars il s'appelle Ka, c'est le bar \xe0 Ka`,`Le gars il s'appelle Cuda, c'est le bar \xe0 Cuda, ha!`,"Le gars il s'appelle Jo, c'est le bar Jo","Le gars il s'appelle Jo, c'est le Jo'bar","Le gars il s'appelle Bichette, c'est le bar'Bichette","Le gars il s'appelle Bo, c'est le Bo bar"];if(t){let e=["https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Alex_Knight_2016_%28Unsplash%29.jpg/330px-Alex_Knight_2016_%28Unsplash%29.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Bar-neon-sign-11291208084Hn6.jpg/330px-Bar-neon-sign-11291208084Hn6.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/Udagawacho%2C_Shibuya%2C_Japan_%28Unsplash%29.jpg/330px-Udagawacho%2C_Shibuya%2C_Japan_%28Unsplash%29.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Is_Open.jpg/330px-Is_Open.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Neon_Open_Sign.jpg/330px-Neon_Open_Sign.jpg"];r=`<h2>${t.properties.Nom}</h2><img src="${e[Math.trunc(Math.random()*e.length)]}" /><p>${t.properties.numeroVoieEtablissement||""}${t.properties.indiceRepetitionEtablissement||""} ${t.properties.libelleVoieEtablissement||""} </p><p>${t.properties.codePostalEtablissement||""} ${t.properties.libelleCommuneEtablissement||""}</p>`}else r=`<h2>Jeux de mots</h2><img class="jamel" src="https://storage.googleapis.com/bleeps-a06a1.appspot.com/bleeps_img/AsterixFilm_2_LePhareAon.jpg" /><p>${l[Math.trunc(Math.random()*l.length)]}</p>`;document.querySelector("aside").innerHTML=r,a&&document.querySelector("aside").appendChild(a)}function l(t,a){e.getFeatures({layerId:4,attr:t,op:"regexp",val:a},t=>{e.addLayerFeatures({id:10,features:t,clear:!0}),i(t)})}function i(a){let l=Array.isArray(a)?a.length:a||0;t.filtered=l||0,l?(e.setLayer({id:10,visible:!0}),e.setLayer({id:4,visible:!1})):(e.setLayer({id:10,visible:!1}),e.setLayer({id:4,visible:!0}));let i=document.querySelector("footer section span.total"),o=document.querySelector("footer section span.selected");t?(i.textContent=t.features.toLocaleString(),o.textContent=t.filtered.toLocaleString()):(i.textContent=0,o.textContent=0),r(a)}MapIFrameAPI.ready("map",function(o){(e=o).getFeatures({},e=>{t={features:e.length,filtered:0},i(0);let o={},s=["CAFE","SARL","TABAC","BISTROT","BAR","BRASSERIE","RESTAURANT","PUB","SNACK","PIZZERIA","TRAITEUR","BISTRO","BISTROT","EURL","COMPTOIR","COFFEE","HOTEL","BUVETTE","RELAIS","AUBERGE","CAVE","MAISON","PIZZA","TAVERNE","CLUB"];e.forEach(e=>{e.properties.Nom.split(/ |-|,/).forEach(e=>{e.length>3&&-1===s.indexOf(e)&&(o[e]||(o[e]=0),o[e]++)})});let n=Object.keys(o).sort((e,t)=>o[t]-o[e]),p="";for(let e=0;e<100;e++)p+=`<a href="#" class="link" data-what="${n[e]}" data-nb="${o[n[e]]}" aria-label="rechercher...">${n[e]}</a> - `;(a=document.createElement("div")).className="links",a.innerHTML=p,a.querySelectorAll(".link").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();let t="\\b"+e.target.dataset.what+"\\b";l("Nom",t),document.querySelector('input[type="search"]').value=t})}),r([])})}),document.querySelector('input[type="search"]').addEventListener("change",e=>{let t=e.target.value;t?l("Nom",t):i(0)}),document.querySelector('input[type="search"]').addEventListener("input",e=>{e.target.value||i(0)}),document.querySelector("header select").value="",document.querySelector("header select").addEventListener("change",t=>{let a=t.target.value;console.log(a),"show"===a?(document.querySelector('input[type="search"]').value="",i(0)):"showall"===a?(document.querySelector('input[type="search"]').value=".*",l("Nom",".*")):"center"===a&&(document.querySelector('input[type="search"]').value?e.setCenter({layerId:10,zoom:16,offsetZoom:-.5}):e.setCenter({layerId:4,zoom:16,offsetZoom:-.5})),t.target.value=""});